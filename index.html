<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Wingman Seguro</title>
    <style>
        /* (El mismo estilo de antes...) */
        :root { --primary: #6c5ce7; --bg: #f9f9fb; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 2rem; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        h1 { color: var(--primary); text-align: center; }
        label { display: block; margin: 15px 0 5px; font-weight: 600; }
        select, textarea, input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        #response { margin-top: 25px; padding: 15px; border-radius: 12px; background: #f1f0ff; display: none; border-left: 5px solid var(--primary); }
        .config { background: #fff5f5; padding: 10px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #ffcccc; }
    </style>
</head>
<body>

<div class="card">
    <h1>ü§ñ AI Wingman Seguro</h1>

    <div class="config">
        <label style="font-size: 0.8rem; color: #cc0000;">‚ö†Ô∏è Pega tu NUEVA API Key aqu√≠ (se guarda solo en este navegador):</label>
        <input type="password" id="apiKey" placeholder="AIza...">
    </div>

    <label>G√©nero de la otra persona:</label>
    <select id="gender">
        <option value="una chica">Una chica</option>
        <option value="un chico">Un chico</option>
    </select>

    <label>√öltimo mensaje recibido:</label>
    <textarea id="inputMsg" rows="3" placeholder="Ej: ¬øQu√© haces hoy?"></textarea>

    <button id="btn" onclick="askAI()">Generar respuesta ‚ú®</button>
    
    <div id="response"></div>
</div>

<script>
    async function askAI() {
        const key = document.getElementById('apiKey').value.trim();
        const msg = document.getElementById('inputMsg').value;
        const gender = document.getElementById('gender').value;
        const responseDiv = document.getElementById('response');

        if (!key) return alert("Por favor, pega tu NUEVA API Key.");
        if (!msg) return alert("Escribe el mensaje de la persona.");

        responseDiv.style.display = "block";
        responseDiv.innerText = "Analizando el mensaje... üöÄ";

        // Ajustamos la instrucci√≥n para que sea m√°s natural
        const promptText = `Tengo 14 a√±os. Me han enviado este mensaje: "${msg}". 
        La persona es ${gender}. 
        Dame 3 opciones de respuesta muy naturales, cortas y con buena vibra. 
        Evita sonar como un robot o demasiado formal. Usa lenguaje de chat.`;

        try {
            // URL actualizada a la versi√≥n v1 (m√°s estable)
            const url = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${key}`;

            const res = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: promptText }]
                    }]
                })
            });

            const data = await res.json();
            
            if (data.error) {
                throw new Error(data.error.message);
            }

            if (data.candidates && data.candidates[0].content) {
                responseDiv.innerText = data.candidates[0].content.parts[0].text;
            } else {
                responseDiv.innerText = "La IA no pudo generar una respuesta. Intenta con otro mensaje.";
            }

        } catch (error) {
            responseDiv.innerText = "Ups! Error: " + error.message;
            console.error("Detalles del error:", error);
        }
    }
</script>

</body>
</html>
